const starsContainer=document.getElementById("expanse-stars");for(let e=0;e<150;e++){const e=document.createElement("div");e.className="expanse-star",e.style.width=2*Math.random()+.5+"px",e.style.height=e.style.width,e.style.top=100*Math.random()+"%",e.style.left=100*Math.random()+"%",e.style.setProperty("--duration",3*Math.random()+2+"s"),starsContainer.appendChild(e)}const canvas=document.getElementById("expanse-canvas"),ctx=canvas.getContext("2d");let isPaused=!1,rotation=0,speedMultiplier=1,currentZoomLevel=window.innerWidth<=768?.7:1;const ZOOM_STEP=.1,MIN_ZOOM=.3,MAX_ZOOM=3;function resizeCanvas(){canvas.width=canvas.clientWidth,canvas.height=canvas.clientHeight}resizeCanvas(),window.addEventListener("resize",resizeCanvas);const siteUrls={meneame:"/rrss/rss/Meneame",renegados:"/rrss/rss/Renegados",mediatize:"/rrss/rss/Mediatize",tardigram:"/rrss/rss/Tardigram",killbait:"/rrss/rss/Killbait"},celestialBodies={meneame:{name:"Menéame",type:"Planeta Central",description:"El planeta principal del sistema, un gigante naranja brillante con anillos de información que orbitan constantemente.",baseSize:54,color:"#f97316",x:0,y:0},renegados:{name:"Renegados",type:"Luna",description:"Una luna rebelde de tono amarillo dorado, conocida por su atmósfera turbulenta y su órbita irregular.",distance:144,speed:1,baseSize:23.4,color:"#eab308"},mediatize:{name:"Mediatize",type:"Luna",description:"Luna púrpura brillante, famosa por sus cristales reflectantes que difunden luz por todo el sistema.",distance:198,speed:.7,baseSize:23.4,color:"#a855f7"},killbait:{name:"Killbait",type:"Luna",description:"Una luna tecnológica de color azul cian que utiliza inteligencia artificial para curar y sintetizar información de todo el sistema.",distance:252,speed:.5,baseSize:23.4,color:"#06b6d4"},tardigram:{name:"Tardigram",type:"Luna",description:"Tardigram, afirman no pertenecer a ningún sistema, pero aún así, aquí están, girando a toda velocidad.",distance:306,speed:.4,baseSize:17.8,color:"#10b981"}};function getMobileScaleFactor(){return currentZoomLevel}function calculatePosition(e,t,n){const a=n*t*speedMultiplier*Math.PI/180;return{x:Math.cos(a)*e,y:Math.sin(a)*e}}function drawPlanet(e,t,n,a,s=!1){const i=ctx.createRadialGradient(e-.3*n,t-.3*n,.1*n,e,t,n);i.addColorStop(0,a+"dd"),i.addColorStop(1,a),ctx.beginPath(),ctx.arc(e,t,n,0,2*Math.PI),ctx.fillStyle=i,ctx.fill(),ctx.beginPath(),ctx.arc(e+.3*n,t+.3*n,.4*n,0,2*Math.PI),ctx.fillStyle="rgba(0, 0, 0, 0.3)",ctx.fill(),ctx.shadowBlur=25,ctx.shadowColor=a,ctx.beginPath(),ctx.arc(e,t,n,0,2*Math.PI),ctx.strokeStyle=a,ctx.lineWidth=1.8,ctx.stroke(),ctx.shadowBlur=0,s&&(ctx.save(),ctx.translate(e,t),ctx.scale(1,.25),ctx.beginPath(),ctx.arc(0,0,1.215*n,0,2*Math.PI),ctx.strokeStyle="#fb923c",ctx.lineWidth=5.4,ctx.shadowBlur=18,ctx.shadowColor="#fb923c",ctx.stroke(),ctx.restore()),!s&&n<48.6&&(ctx.fillStyle="rgba(0, 0, 0, 0.2)",ctx.beginPath(),ctx.arc(e+.2*n,t-.3*n,.15*n,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.arc(e-.3*n,t+.1*n,.12*n,0,2*Math.PI),ctx.fill())}function drawOrbit(e,t,n){ctx.beginPath(),ctx.arc(e,t,n,0,2*Math.PI),ctx.strokeStyle="rgba(107, 114, 128, 0.3)",ctx.lineWidth=.9,ctx.stroke()}function drawLabel(e,t,n,a,s){const i=window.innerWidth<768?"11px":"13px";ctx.font=`bold ${i} "Segoe UI"`,ctx.fillStyle=a,ctx.shadowBlur=7,ctx.shadowColor=a,ctx.textAlign="center",ctx.fillText(n,e,t+s),ctx.shadowBlur=0}function animate(){isPaused||(rotation+=.1*speedMultiplier),ctx.clearRect(0,0,canvas.width,canvas.height);const e=canvas.width/2,t=canvas.height/2,n=getMobileScaleFactor();Object.entries(celestialBodies).forEach((([a,s])=>{if("meneame"!==a){const a=s.distance*n;drawOrbit(e,t,a)}}));const a=celestialBodies.meneame.baseSize*n;drawPlanet(e,t,a,celestialBodies.meneame.color,!0);drawLabel(e,t,"Menéame","#ffffff",a+16.2),Object.entries(celestialBodies).forEach((([a,s])=>{if("meneame"!==a){const a=s.distance*n,i=s.baseSize*n,c=calculatePosition(a,s.speed,rotation);s.x=e+c.x,s.y=t+c.y,drawPlanet(s.x,s.y,i,s.color),drawLabel(s.x,s.y,s.name,s.color,i+16.2)}})),requestAnimationFrame(animate)}function showInfo(e,t){document.getElementById("expanse-infoName").textContent=t.name,document.getElementById("expanse-infoType").textContent=t.type,document.getElementById("expanse-infoDescription").textContent=t.description;const n=document.getElementById("expanse-infoLink");n.href=siteUrls[e],n.textContent=`Noticias ${t.name}`,document.getElementById("expanse-infoPanel").classList.add("active")}function setSpeed(e){speedMultiplier=e,document.getElementById("expanse-speed1Btn").classList.remove("active"),document.getElementById("expanse-speed2Btn").classList.remove("active"),document.getElementById("expanse-speed3Btn").classList.remove("active"),document.getElementById(`expanse-speed${e}Btn`).classList.add("active")}canvas.addEventListener("click",(e=>{const t=canvas.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;Object.entries(celestialBodies).forEach((([e,t])=>{const s="meneame"===e?canvas.width/2:t.x,i="meneame"===e?canvas.height/2:t.y,c=getMobileScaleFactor(),o="meneame"===e?celestialBodies.meneame.baseSize*c:t.baseSize*c;Math.sqrt((n-s)**2+(a-i)**2)<1.2*o&&showInfo(e,t)}))})),document.getElementById("expanse-speed1Btn").addEventListener("click",(()=>setSpeed(1))),document.getElementById("expanse-speed2Btn").addEventListener("click",(()=>setSpeed(2))),document.getElementById("expanse-speed3Btn").addEventListener("click",(()=>setSpeed(3))),document.getElementById("expanse-pauseBtn").addEventListener("click",(()=>{isPaused=!isPaused,document.getElementById("expanse-pauseBtn").textContent=isPaused?"▶":"⏸"})),document.getElementById("expanse-zoomInBtn").addEventListener("click",(()=>{currentZoomLevel<3&&(currentZoomLevel+=.1)})),document.getElementById("expanse-zoomOutBtn").addEventListener("click",(()=>{currentZoomLevel>.3&&(currentZoomLevel-=.1)})),document.getElementById("expanse-closeBtn").addEventListener("click",(()=>{document.getElementById("expanse-infoPanel").classList.remove("active")})),document.getElementById("expanse-projectInfoBtn").addEventListener("click",(()=>{document.getElementById("expanse-projectInfoPanel").classList.add("active")})),document.getElementById("expanse-closeProjectBtn").addEventListener("click",(()=>{document.getElementById("expanse-projectInfoPanel").classList.remove("active")})),animate();